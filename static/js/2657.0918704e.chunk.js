"use strict";(self.webpackChunkopendata_backend_prabulinggih=self.webpackChunkopendata_backend_prabulinggih||[]).push([[1613,2657],{1365:(e,t,i)=>{i.r(t),i.d(t,{default:()=>x});var r=i(37055),s=i(35143),o=i(50076),n=i(50346),a=i(90534),l=i(46053),d=i(81806),u=(i(76460),i(47249),i(28379)),c=i(85842),p=i(13312),h=i(38451),v=i(49304),y=i(16783),f=i(76797),g=i(77725);let m=class extends v.A{constructor(e){super(e),this.type="csv",this.refresh=(0,n.sg)(async e=>{await this.load();const{extent:t,timeExtent:i}=await this._connection.invoke("refresh",e);return t&&(this.sourceJSON.extent=t),i&&(this.sourceJSON.timeInfo.timeExtent=[i.start,i.end]),{dataChanged:!0,updates:{extent:this.sourceJSON.extent,timeInfo:this.sourceJSON.timeInfo}}})}load(e){const t=null!=e?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){var e;null!==(e=this._connection)&&void 0!==e&&e.close(),this._connection=null}async openPorts(){return await this.load(),this._connection.openPorts()}async queryFeatures(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);return g.A.fromJSON(i)}async queryFeaturesJSON(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.load(t),this._connection.invoke("queryFeatures",e?e.toJSON():null,t)}async queryFeatureCount(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.load(t),this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t)}async queryObjectIds(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.load(t),this._connection.invoke("queryObjectIds",e?e.toJSON():null,t)}async queryExtent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};await this.load(t);const i=await this._connection.invoke("queryExtent",e?e.toJSON():null,t);return{count:i.count,extent:f.A.fromJSON(i.extent)}}async querySnapping(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.load(t),this._connection.invoke("querySnapping",e,t)}async queryAttributeBins(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.load(),this._connection.invoke("queryAttributeBins",e?e.toJSON():null,t)}async _startWorker(e){this._connection=await(0,y.ho)("CSVSourceWorker",{strategy:(0,d.A)("feature-layers-workers")?"dedicated":"local",signal:e,registryTarget:this});const{url:t,delimiter:i,fields:r,latitudeField:s,longitudeField:o,spatialReference:n,timeInfo:a}=this.loadOptions,l=await this._connection.invoke("load",{url:t,customParameters:this.customParameters,parsingOptions:{delimiter:i,fields:null===r||void 0===r?void 0:r.map(e=>e.toJSON()),latitudeField:s,longitudeField:o,spatialReference:null===n||void 0===n?void 0:n.toJSON(),timeInfo:null===a||void 0===a?void 0:a.toJSON()}},{signal:e});this.locationInfo=l.locationInfo,this.sourceJSON=l.layerDefinition,this.delimiter=l.delimiter}};(0,s._)([(0,l.MZ)()],m.prototype,"type",void 0),(0,s._)([(0,l.MZ)()],m.prototype,"loadOptions",void 0),(0,s._)([(0,l.MZ)()],m.prototype,"customParameters",void 0),(0,s._)([(0,l.MZ)()],m.prototype,"locationInfo",void 0),(0,s._)([(0,l.MZ)()],m.prototype,"sourceJSON",void 0),(0,s._)([(0,l.MZ)()],m.prototype,"delimiter",void 0),m=(0,s._)([(0,c.$)("esri.layers.graphics.sources.CSVSource")],m);var _=i(40296),b=i(97015),w=i(79453);function F(e,t){throw new o.A(t,"CSVLayer (title: ".concat(e.title,", id: ").concat(e.id,") cannot be saved to a portal item"))}let I=class extends h.default{constructor(){super(...arguments),this.geometryType="point",this.capabilities=(0,_.f)(!1,!1),this.delimiter=null,this.editingEnabled=!1,this.fields=null,this.latitudeField=null,this.locationType="coordinates",this.longitudeField=null,this.operationalLayerType="CSV",this.outFields=["*"],this.path=null,this.spatialReference=p.A.WGS84,this.source=null,this.type="csv"}normalizeCtorArgs(e,t){return"string"==typeof e?(0,r.A)({url:e},t):e}load(e){const t=null!=e?e.signal:null,i=this.loadFromPortal({supportedTypes:["CSV"],supportsData:!1},e).catch(n.QP).then(async()=>this.initLayerProperties(await this.createGraphicsSource(t)));return this.addResolvingPromise(i),Promise.resolve(this)}get isTable(){return this.loaded&&null==this.geometryType}readWebMapLabelsVisible(e,t){var i;return null!=t.showLabels?t.showLabels:!(null===(i=t.layerDefinition)||void 0===i||null===(i=i.drawingInfo)||void 0===i||!i.labelingInfo)}set url(e){if(!e)return void this._set("url",e);const t=(0,a.An)(e);this._set("url",t.path),t.query&&(this.customParameters=(0,r.A)((0,r.A)({},this.customParameters),t.query))}async createGraphicsSource(e){var t,i,r,s,o;const n=new m({loadOptions:{delimiter:this.delimiter,fields:this.fields,latitudeField:null!==(t=this.latitudeField)&&void 0!==t?t:void 0,longitudeField:null!==(i=this.longitudeField)&&void 0!==i?i:void 0,spatialReference:null!==(r=this.spatialReference)&&void 0!==r?r:void 0,timeInfo:null!==(s=this.timeInfo)&&void 0!==s?s:void 0,url:this.url},customParameters:null!==(o=this.customParameters)&&void 0!==o?o:void 0});return this._set("source",n),await n.load({signal:e}),this.read({locationInfo:n.locationInfo,columnDelimiter:n.delimiter},{origin:"service",url:this.parsedUrl}),n}queryFeatures(e,t){return this.load().then(()=>this.source.queryFeatures(b.A.from(e)||this.createQuery())).then(e=>{if(null!==e&&void 0!==e&&e.features)for(const t of e.features)t.layer=t.sourceLayer=this;return e})}async queryObjectIds(e,t){return await this.load(),this.source.queryObjectIds(b.A.from(e)||this.createQuery())}queryFeatureCount(e,t){return this.load().then(()=>this.source.queryFeatureCount(b.A.from(e)||this.createQuery()))}queryExtent(e,t){return this.load().then(()=>this.source.queryExtent(b.A.from(e)||this.createQuery()))}read(e,t){super.read(e,t),t&&"service"===t.origin&&this.revert(["latitudeField","longitudeField"],"service")}write(e,t){return super.write(e,(0,r.A)((0,r.A)({},t),{},{writeLayerSchema:!0}))}clone(){throw new o.A("csv-layer:clone","CSVLayer (title: ".concat(this.title,", id: ").concat(this.id,") cannot be cloned"))}async save(e){return F(this,"csv-layer:save")}async saveAs(e,t){return F(this,"csv-layer:save-as")}async hasDataChanged(){try{const{dataChanged:e,updates:t}=await this.source.refresh(this.customParameters);return null!=t&&this.read(t,{origin:"service",url:this.parsedUrl,ignoreDefaults:!0}),e}catch(e){}return!1}_verifyFields(){}_verifySource(){}_hasMemorySource(){return!1}};(0,s._)([(0,l.MZ)({readOnly:!0,json:{read:!1,write:!1}})],I.prototype,"capabilities",void 0),(0,s._)([(0,l.MZ)({type:[","," ",";","|","\t"],json:{read:{source:"columnDelimiter"},write:{target:"columnDelimiter",ignoreOrigin:!0}}})],I.prototype,"delimiter",void 0),(0,s._)([(0,l.MZ)({readOnly:!0,type:Boolean,json:{origins:{"web-scene":{read:!1,write:!1}}}})],I.prototype,"editingEnabled",void 0),(0,s._)([(0,l.MZ)({json:{read:{source:"layerDefinition.fields"},write:{target:"layerDefinition.fields"}}})],I.prototype,"fields",void 0),(0,s._)([(0,l.MZ)({type:Boolean,readOnly:!0})],I.prototype,"isTable",null),(0,s._)([(0,u.w)("web-map","labelsVisible",["layerDefinition.drawingInfo.labelingInfo","showLabels"])],I.prototype,"readWebMapLabelsVisible",null),(0,s._)([(0,l.MZ)({type:String,json:{read:{source:"locationInfo.latitudeFieldName"},write:{target:"locationInfo.latitudeFieldName",ignoreOrigin:!0}}})],I.prototype,"latitudeField",void 0),(0,s._)([(0,l.MZ)({type:["show","hide"]})],I.prototype,"listMode",void 0),(0,s._)([(0,l.MZ)({type:["coordinates"],json:{read:{source:"locationInfo.locationType"},write:{target:"locationInfo.locationType",ignoreOrigin:!0,isRequired:!0}}})],I.prototype,"locationType",void 0),(0,s._)([(0,l.MZ)({type:String,json:{read:{source:"locationInfo.longitudeFieldName"},write:{target:"locationInfo.longitudeFieldName",ignoreOrigin:!0}}})],I.prototype,"longitudeField",void 0),(0,s._)([(0,l.MZ)({type:["CSV"]})],I.prototype,"operationalLayerType",void 0),(0,s._)([(0,l.MZ)()],I.prototype,"outFields",void 0),(0,s._)([(0,l.MZ)({type:String,json:{origins:{"web-scene":{read:!1,write:!1}},read:!1,write:!1}})],I.prototype,"path",void 0),(0,s._)([(0,l.MZ)({json:{read:!1},cast:null,type:m,readOnly:!0})],I.prototype,"source",void 0),(0,s._)([(0,l.MZ)({json:{read:!1},value:"csv",readOnly:!0})],I.prototype,"type",void 0),(0,s._)([(0,l.MZ)({json:{read:w.r,write:{isRequired:!0,ignoreOrigin:!0,writer:w.w}}})],I.prototype,"url",null),I=(0,s._)([(0,c.$)("esri.layers.CSVLayer")],I);const x=I},20665:(e,t,i)=>{i.d(t,{A:()=>h});var r=i(37055),s=i(35143),o=i(91967),n=i(18690),a=i(98773),l=i(94643),d=i(46053),u=(i(81806),i(76460),i(85842)),c=i(53430),p=i(76386);let h=class extends o.A{constructor(e){super(e),this._featureUtils=null,this.effectivePopupTemplate=null}get _arcadeTask(){return this.expressionsUsedInTitle.length>0?this._get("_arcadeTask")||(0,a.UT)(()=>(0,p.l)()):null}get featureUtilsPromise(){var e;return null!==(e=this._get("featureUtilsPromise"))&&void 0!==e?e:i.e(9912).then(i.bind(i,9912)).then(e=>this._featureUtils=e)}get calculatedExpressions(){var e;const t=new l.A;if(!this.expressionsUsedInTitle.length)return t;if(null===(e=this._arcadeTask)||void 0===e||!e.value){for(const e of null!==(i=this.expressionsUsedInTitle)&&void 0!==i?i:[]){var i;t.push({name:e.name,invalid:!0})}return t}for(const s of this.expressionsUsedInTitle)try{const e=this._arcadeTask.value.arcade.parseScript(s.expression,["$layer","$map","$datastore"]);if(e.isAsync){t.push({name:s.name,invalid:!0});break}t.push({name:s.name,syntax:e,invalid:!1,func:this._arcadeTask.value.arcade.compileScript(e,{vars:{$feature:"any"}})})}catch(r){t.push({name:s.name,invalid:!0});break}return t}get expressionsUsedInTitle(){var e,t,i,r;let s=null!==(e=null===(t=this.effectivePopupTemplate)||void 0===t?void 0:t.title)&&void 0!==e?e:"";return"string"!=typeof s?[]:(s=s.toLowerCase(),null!==(i=null===(r=this.effectivePopupTemplate)||void 0===r||null===(r=r.expressionInfos)||void 0===r?void 0:r.filter(e=>s.includes("{expression/".concat(e.name.toLowerCase(),"}"))))&&void 0!==i?i:[])}get fieldInfoMap(){return this._featureUtils?this._createFieldInfoMap(this._featureUtils.getAllFieldInfos(this.effectivePopupTemplate)):null}get hasBadExpressions(){return this.calculatedExpressions.some(e=>!0===e.invalid)}get requiredFields(){var e;const t=new Set;if(null!==(e=this._arcadeTask)&&void 0!==e&&e.value&&!this.hasBadExpressions)for(const a of null!==(i=null===(r=this.calculatedExpressions)||void 0===r?void 0:r.toArray())&&void 0!==i?i:[]){var i,r;try{const e=this._arcadeTask.value.arcade.extractFieldLiterals(a.syntax);for(const i of e){var s;const e=i.split("."),r=this.fieldsIndex.get(null!==(s=e.at(-1))&&void 0!==s?s:"");r&&t.add(r.name)}}catch(n){}}const o=this._extractFieldNames(this.workingTitle);for(const a of o){const e=this.fieldsIndex.get(a);e&&t.add(e.name)}return null!=this.objectIdField&&t.add(this.objectIdField),t}get titleFromDisplayField(){var e,t,i,r;let s="";return this.displayField&&(s=null!==(e=null===(t=this.fieldsIndex.get(this.displayField))||void 0===t?void 0:t.name)&&void 0!==e?e:""),s||(s=null!==(i=null===(r=this.fieldsIndex.get(this.objectIdField))||void 0===r?void 0:r.name)&&void 0!==i?i:""),s?"{".concat(s,"}"):""}get workingTitle(){const e=this.effectivePopupTemplate?this.effectivePopupTemplate.title:"";return""===e||null==e||this.hasBadExpressions||"string"!=typeof e?this.titleFromDisplayField:e}async getTitle(e,t,i){var r,s;const o=null!==(r=t.getObjectId())&&void 0!==r?r:t.attributes[e.objectIdField];return null!==(s=(await this.getTitles(e,[t],i)).get(o))&&void 0!==s?s:""}async getTitles(e,t,i){var r;const s=new Map,o=null!==(r=null===i||void 0===i?void 0:i.timeZone)&&void 0!==r?r:"system";try{var n;const[{substituteFieldsInLinksAndAttributes:r}]=await Promise.all([this.featureUtilsPromise,null===(n=this._arcadeTask)||void 0===n?void 0:n.promise]);(null===i||void 0===i?void 0:i.fetchMissingFields)&&(t=await this._checkAndReQueryGraphics(e,t));const{fieldInfoMap:a,workingTitle:l}=this,d=l&&a;t.forEach(t=>{var i;const n=null!==(i=t.getObjectId())&&void 0!==i?i:t.attributes[e.objectIdField],u=d?r({attributes:t.attributes,expressionAttributes:null,fieldInfoMap:a,globalAttributes:this._createFormattedAttributes(e,t,o).global,layer:e,text:l}):"";s.set(n,u)})}catch(a){}return s}async _checkAndReQueryGraphics(e,t){const i=t.map(t=>{var i;return null!==(i=t.getObjectId())&&void 0!==i?i:t.attributes[e.objectIdField]}).filter(n.Ru);if(i.length!==t.length)return t;if(t.some(e=>!(0,c.Kl)(e,this.requiredFields))){const r=e.createQuery();r.where="1=1",r.outFields=[...this.requiredFields],r.objectIds=i;const s=await e.queryFeatures(r);if((null===s||void 0===s?void 0:s.features.length)===t.length)return s.features}return t}_createFieldInfoMap(e){const t=new Map;if(!e)return t;for(const r of e){var i;if(!r.fieldName)continue;const e=this.fieldsIndex.get(r.fieldName),s=null!==(i=null===e||void 0===e?void 0:e.name)&&void 0!==i?i:r.fieldName;r.fieldName=s,t.set(s.toLowerCase(),r)}return t}_createFormattedAttributes(e,t){var i,s,o;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"system";const a=null!==(i=null===(s=this.effectivePopupTemplate)||void 0===s?void 0:s.fieldInfos)&&void 0!==i?i:[],l={};if(!this._featureUtils)return{};if(!this.hasBadExpressions&&this.calculatedExpressions.length>0&&null!==(o=this._arcadeTask)&&void 0!==o&&o.value){const i=this._arcadeTask.value.Feature.createFromGraphicLikeObject(t.geometry,t.attributes,e,null);for(const e of this.calculatedExpressions)try{l["expression/".concat(e.name)]=e.func({vars:{$feature:i}})}catch(u){}}const d=(0,r.A)((0,r.A)({},t.attributes),l);return{global:this._featureUtils.formatAttributes({fieldInfos:a,attributes:d,graphic:t,timeZone:n,layer:e,fieldInfoMap:this.fieldInfoMap}),content:[]}}_extractFieldNames(e){return(0,c.nw)(e).filter(e=>!(0===e.indexOf("relationships/")||0===e.indexOf("expression/")))}};(0,s._)([(0,d.MZ)({readOnly:!0})],h.prototype,"_arcadeTask",null),(0,s._)([(0,d.MZ)()],h.prototype,"_featureUtils",void 0),(0,s._)([(0,d.MZ)({readOnly:!0})],h.prototype,"featureUtilsPromise",null),(0,s._)([(0,d.MZ)({readOnly:!0})],h.prototype,"calculatedExpressions",null),(0,s._)([(0,d.MZ)()],h.prototype,"displayField",void 0),(0,s._)([(0,d.MZ)()],h.prototype,"effectivePopupTemplate",void 0),(0,s._)([(0,d.MZ)()],h.prototype,"expressionsUsedInTitle",null),(0,s._)([(0,d.MZ)()],h.prototype,"fieldsIndex",void 0),(0,s._)([(0,d.MZ)()],h.prototype,"fieldInfoMap",null),(0,s._)([(0,d.MZ)()],h.prototype,"fields",void 0),(0,s._)([(0,d.MZ)()],h.prototype,"objectIdField",void 0),(0,s._)([(0,d.MZ)()],h.prototype,"requiredFields",null),h=(0,s._)([(0,u.$)("esri.layers.support.TitleCreator")],h)},61701:(e,t,i)=>{var r;i.d(t,{X:()=>r}),function(e){e[e.SAVE=0]="SAVE",e[e.SAVE_AS=1]="SAVE_AS"}(r||(r={}))}}]);
//# sourceMappingURL=2657.0918704e.chunk.js.map