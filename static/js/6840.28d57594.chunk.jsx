"use strict";(self.webpackChunkopendata_backend_prabulinggih=self.webpackChunkopendata_backend_prabulinggih||[]).push([[6840],{6840:(e,t,i)=>{i.r(t),i.d(t,{CIMSymbolRasterizer:()=>c});var h=i(19902),s=i(30050),n=i(94110),r=i(401),a=i(48988),l=i(83367),o=i(97763);const g=96/72;class c{constructor(e){this._spatialReference=e,this._imageDataCanvas=null,this._cimResourceManager=new s.A}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(e,t,i,s,n,g,c,u,y,w){if(!e)return null;const{data:m}=e;if(!m||"CIMSymbolReference"!==m.type||!m.symbol)return null;const{symbol:p}=m;g||(g=(0,o.n5)(p));const M=await a.OverrideHelper.resolveSymbolOverrides(m,t,this._spatialReference,n,g,c,u),_=this._cimResourceManager,b=[];r.wp.fetchResources(M,_,b),r.wp.fetchFonts(M,_,b),b.length>0&&await Promise.all(b);const{width:R,height:x}=i;let f=d(g,R,x,s,w);const v=r.wp.getEnvelope(M,f,_);if(!v)return null;v.x===1/0&&(v.x=R+2),v.y===1/0&&(v.y=-x/2),v.width===-1/0&&(v.width=R),v.height===-1/0&&(v.height=x);let C=1,I=0,P=0;switch(p.type){case"CIMPointSymbol":case"CIMTextSymbol":{let e=1;v.width>R&&(e=R/v.width);let t=1;v.height>x&&(t=x/v.height),"preview"===s&&(v.width<R&&(e=R/v.width),v.height<x&&(t=x/v.height)),C=Math.min(e,t),I=v.x+v.width/2,P=v.y+v.height/2}break;case"CIMLineSymbol":if(w){P=v.y+v.height/2,I=v.x+v.width/2;const e=v.width-R,t=v.height-x;f={paths:(0,l.hs)(f.paths,{xmin:-1*v.width/2+e,xmax:v.width/2-e,ymin:-1*v.height/2+t,ymax:v.height/2-t,width:v.width-2*e,height:v.height-2*t})}}else{(y||v.height>x)&&(C=x/v.height),P=v.y+v.height/2;const e=v.x*C+R/2,t=(v.x+v.width)*C+R/2,i=(0,h.Rg)(f)?f.paths:(0,h.Bi)(f)?f.rings:null;if(null===i)throw new Error("Bad geometry, can't rasterise symbol!");i[0][0][0]-=e/C,i[0][2][0]-=(t-R)/C}break;case"CIMPolygonSymbol":if(w){P=v.y+v.height/2,I=v.x+v.width/2;const e=v.width-R,t=v.height-x;f={paths:(0,l.hs)(f.rings,{xmin:-1*v.width/2+e,xmax:v.width/2-e,ymin:-1*v.height/2+t,ymax:v.height/2-t,width:v.width-2*e,height:v.height-2*t})}}else{I=v.x+v.width/2,P=v.y+v.height/2;const e=v.x*C+R/2,t=(v.x+v.width)*C+R/2,i=v.y*C+x/2,h=(v.y+v.height)*C+x/2,{rings:s}=f;e<0&&(s[0][0][0]-=e,s[0][3][0]-=e,s[0][4][0]-=e),i<0&&(s[0][0][1]+=i,s[0][1][1]+=i,s[0][4][1]+=i),t>R&&(s[0][1][0]-=t-R,s[0][2][0]-=t-R),h>x&&(s[0][2][1]+=h-x,s[0][3][1]+=h-x)}}const S={type:"cim",data:{type:"CIMSymbolReference",symbol:M}};return this.rasterize(S,R,x,I,P,C,g,1,f)}rasterize(e,t,i,h,s,r,a){let l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:window.devicePixelRatio||1;const{data:y}=e;if(!y||"CIMSymbolReference"!==y.type||!y.symbol)return null;const{symbol:w}=y,m=this._canvas,p=u*g;m.width=t*p,m.height=i*p,a||(a=(0,o.n5)(w)),c||(c=d(a,t,i,"legend")),m.width+=2*l,m.height+=2*l;const M=m.getContext("2d",{willReadFrequently:!0}),_=n.IT.createIdentity();return _.translate(-h,-s),_.scale(r*p,-r*p),_.translate(t*p/2+l,i*p/2+l),M.clearRect(0,0,m.width,m.height),new n.Rj(M,this._cimResourceManager,_,!0).drawSymbol(w,c),M.getImageData(0,0,m.width,m.height)}}function d(e,t,i,h,s){const n=-t/2+1,r=t/2-1,a=i/2-1,o=-i/2+1;if(s&&("esriGeometryPolygon"===e||"esriGeometryPolyline"===e)){const h=function(e,t,i,h){return"esriGeometryPolygon"===t?{rings:(0,l.Tl)((0,l.hs)(e.rings,{xmin:0,ymin:0,width:i,height:h}),-1*i/2,-1*h/2)}:"esriGeometryPolyline"===t?{paths:(0,l.Tl)((0,l.hs)(e.paths,{xmin:0,ymin:0,width:i,height:h}),-1*i/2,-1*h/2)}:null}(s,e,t,i);if(h)return h}switch(e){case"esriGeometryPoint":return{x:0,y:0};case"esriGeometryPolyline":return{paths:[[[n,0],[0,0],[r,0]]]};default:return"legend"===h?{rings:[[[n,a],[r,0],[r,o],[n,o],[n,a]]]}:{rings:[[[n,a],[r,a],[r,o],[n,o],[n,a]]]}}}},30050:(e,t,i)=>{i.d(t,{A:()=>n});var h=i(85504),s=i(16770);class n{constructor(){this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}destroy(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}getResource(e){var t;return null!==(t=this._resourceMap.get(e))&&void 0!==t?t:null}async fetchResource(e,t){const i=this._resourceMap.get(e);if(i)return{width:i.width,height:i.height};let h=this._inFlightResourceMap.get(e);return h?h.then(e=>({width:e.width,height:e.height})):(h=(0,s.M5)(e,t),this._inFlightResourceMap.set(e,h),h.then(t=>(this._inFlightResourceMap.delete(e),this._resourceMap.set(e,t),{width:t.width,height:t.height}),()=>({width:0,height:0})))}deleteResource(e){this._inFlightResourceMap.delete(e),this._resourceMap.delete(e)}loadFont(e){return(0,h.Al)(e)}}}}]);
//# sourceMappingURL=6840.28d57594.chunk.js.map